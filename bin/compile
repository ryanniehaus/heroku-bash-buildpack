#!/usr/bin/env bash
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR

echo "-----> Running bin/compile (passed BUILD_DIR=$1, CACHE_DIR=$2, ENV_DIR=$3)"
export
echo in dir `pwd`
for each in $(find . -type d)
do
  echo DIR "$each"
  ls -la "$each"
done
echo in dir "$1"
for each in $(find "$1" -type d)
do
  echo DIR "$each"
  ls -la "$each"
done
echo in dir "$2"
for each in $(find "$2" -type d)
do
  echo DIR "$each"
  ls -la "$each"
done
echo in dir "$3"
for each in $(find "$3" -type d)
do
  echo DIR "$each"
  ls -la "$each"
done

  env_dir="$3"
  whitelist_regex=${2:-''}
  blacklist_regex=${3:-''}
  if [ -d "$env_dir" ]; then
    echo exporting variables from $env_dir
    for e in $(ls $env_dir); do
    	# | grep -qvE "$blacklist_regex"
      echo "$e" | grep -E "$whitelist_regex" &&
      export "$e=$(cat $env_dir/$e)"
      :
    done
  fi
  export TEMP_APP_DIR=/tmp
exit 0

